# 簡化道具系統使用說明

## 概述
這是一個簡化版的隻狼風格道具系統，將原本5個檔案整合為4個檔案，大幅減少程式碼複雜度，同時保持所有核心功能。系統使用TextMeshPro提供更好的文字渲染效果。

### 🎯 簡化特色
- ✅ **4個檔案搞定** - 從原本5個檔案簡化為4個
- ✅ **程式碼減少53%** - 大幅減少程式碼量
- ✅ **功能完整保留** - 所有核心功能都保留
- ✅ **易於維護** - 結構更清晰，更容易修改
- ✅ **隻狼風格** - 保持原有的隻狼操作體驗
- ✅ **TextMeshPro支援** - 使用現代化的文字渲染系統

## 檔案結構

### 核心檔案
1. **ItemSystem.cs** - 道具系統主控制器 + UI管理
2. **ItemSlotUI.cs** - 道具槽UI組件（獨立檔案）
3. **ItemPickup.cs** - 道具拾取系統
4. **ItemManager.cs** - 道具生成管理器

### 移除的檔案
- ~~舊版ItemSystem.cs~~ - 功能整合到新的ItemSystem
- ~~ItemUI.cs~~ - 功能整合到ItemSystem
- ~~舊版ItemSlotUI.cs~~ - 替換為新的獨立ItemSlotUI
- ~~舊版ItemPickup.cs~~ - 替換為新的ItemPickup
- ~~舊版ItemManager.cs~~ - 替換為新的ItemManager

## 安裝步驟

### 1. 設置玩家道具系統
1. 在玩家物件上添加 `ItemSystem` 組件
2. 配置UI組件：

#### UI組件詳細設置說明

**`itemContainer` (道具槽容器)**
- **類型**: Transform
- **用途**: 存放所有道具槽的父物件
- **設置方法**: 
  1. 在Canvas下創建一個空的GameObject，命名為"ItemContainer"
  2. 將此GameObject的Transform拖拽到ItemSystem組件的itemContainer欄位
- **建議位置**: Canvas > ItemContainer

**`itemSlotPrefab` (道具槽預製體)**
- **類型**: GameObject (Prefab)
- **用途**: 單個道具槽的預製體模板
- **創建步驟**:
  1. 在Hierarchy中創建UI > Image，命名為"ItemSlot"
  2. 在ItemSlot下添加子物件：
     - Image (道具圖示) - 命名為"ItemIcon"
     - Text (TMP) (數量文字) - 命名為"QuantityText"
     - Text (TMP) (快捷鍵) - 命名為"HotkeyText"
     - Image (背景) - 命名為"Background"
     - Image (冷卻遮罩) - 命名為"CooldownOverlay"
  3. 添加 `ItemSlotUI` 組件到ItemSlot（此組件現在是獨立檔案）
  4. 將ItemSlot拖拽到Project視窗創建預製體
  5. 將預製體拖拽到ItemSystem組件的itemSlotPrefab欄位

**`currentItemText` (當前道具文字)**
- **類型**: Text (TMP) (TextMeshPro)
- **用途**: 顯示當前選中道具的名稱和數量
- **設置方法**:
  1. 在Canvas下創建UI > Text - TextMeshPro，命名為"CurrentItemText"
  2. 設置文字樣式（字體、大小、顏色等）
  3. 將此TMP_Text組件拖拽到ItemSystem組件的currentItemText欄位
- **建議位置**: Canvas > CurrentItemText

**`currentItemIcon` (當前道具圖示)**
- **類型**: Image (UI)
- **用途**: 顯示當前選中道具的圖示
- **設置方法**:
  1. 在Canvas下創建UI > Image，命名為"CurrentItemIcon"
  2. 設置Image的大小和位置
  3. 將此Image組件拖拽到ItemSystem組件的currentItemIcon欄位
- **建議位置**: Canvas > CurrentItemIcon

**`useProgressBar` (使用進度條)**
- **類型**: Image (UI)
- **用途**: 顯示道具使用時的進度條
- **設置方法**:
  1. 在Canvas下創建UI > Image，命名為"UseProgressBar"
  2. 設置Image Type為"Filled"
  3. 設置Fill Method為"Horizontal"或"Radial 360"
  4. 設置初始Fill Amount為0
  5. 將此Image組件拖拽到ItemSystem組件的useProgressBar欄位
- **建議位置**: Canvas > UseProgressBar

#### 完整的UI層級結構建議
```
Canvas
├── ItemContainer (Transform)
│   ├── ItemSlot1 (Prefab Instance)
│   ├── ItemSlot2 (Prefab Instance)
│   └── ItemSlot3 (Prefab Instance)
├── CurrentItemText (Text - TextMeshPro)
├── CurrentItemIcon (Image)
└── UseProgressBar (Image)
```

#### ItemSlot預製體詳細結構
```
ItemSlot (GameObject + ItemSlotUI組件)
├── Background (Image) - 道具槽背景
├── ItemIcon (Image) - 道具圖示
├── QuantityText (Text - TextMeshPro) - 數量顯示
├── HotkeyText (Text - TextMeshPro) - 快捷鍵顯示
└── CooldownOverlay (Image) - 冷卻遮罩
```

**注意**: ItemSlotUI組件現在是獨立的檔案 `ItemSlotUI.cs`，不再是ItemSystem.cs的內部類別。

#### 組件引用設置
在ItemSlotUI組件中設置以下引用：
- **icon**: 拖拽ItemIcon的Image組件
- **quantityText**: 拖拽QuantityText的TMP_Text組件
- **hotkeyText**: 拖拽HotkeyText的TMP_Text組件
- **background**: 拖拽Background的Image組件
- **cooldownOverlay**: 拖拽CooldownOverlay的Image組件

### 2. 創建道具槽預製體（詳細步驟）

#### 步驟1：創建基礎UI結構
1. 在Hierarchy中右鍵 > UI > Image，創建道具槽基礎
2. 重命名為"ItemSlot"
3. 設置RectTransform大小（建議：80x80）

#### 步驟2：添加子物件
在ItemSlot下添加以下子物件：

**Background (背景)**
- 右鍵ItemSlot > UI > Image
- 重命名為"Background"
- 設置為道具槽的背景圖片
- 建議顏色：深灰色或透明

**ItemIcon (道具圖示)**
- 右鍵ItemSlot > UI > Image
- 重命名為"ItemIcon"
- 設置為道具的圖示
- 建議大小：60x60

**QuantityText (數量文字)**
- 右鍵ItemSlot > UI > Text - TextMeshPro
- 重命名為"QuantityText"
- 設置文字樣式：
  - 字體大小：16
  - 顏色：白色
  - 對齊：右下角
- 建議位置：右下角

**HotkeyText (快捷鍵文字)**
- 右鍵ItemSlot > UI > Text - TextMeshPro
- 重命名為"HotkeyText"
- 設置文字樣式：
  - 字體大小：12
  - 顏色：黃色
  - 對齊：左上角
- 建議位置：左上角

**CooldownOverlay (冷卻遮罩)**
- 右鍵ItemSlot > UI > Image
- 重命名為"CooldownOverlay"
- 設置Image Type為"Filled"
- 設置Fill Method為"Radial 360"
- 設置顏色為半透明黑色
- 初始Fill Amount設為0

#### 步驟3：添加組件
1. 選擇ItemSlot物件
2. 在Inspector中點擊"Add Component"
3. 搜尋並添加"ItemSlotUI"組件
   - **注意**: 此組件現在是獨立的檔案 `ItemSlotUI.cs`
   - 如果找不到此組件，請確保 `ItemSlotUI.cs` 檔案已正確編譯

#### 步驟4：設置組件引用
在ItemSlotUI組件中設置以下引用：
- **icon**: 拖拽ItemIcon的Image組件
- **quantityText**: 拖拽QuantityText的TMP_Text組件
- **hotkeyText**: 拖拽HotkeyText的TMP_Text組件
- **background**: 拖拽Background的Image組件
- **cooldownOverlay**: 拖拽CooldownOverlay的Image組件

#### 步驟5：創建預製體
1. 將ItemSlot從Hierarchy拖拽到Project視窗
2. 刪除Hierarchy中的ItemSlot
3. 將Project中的預製體拖拽到ItemSystem組件的itemSlotPrefab欄位

### 3. 設置道具拾取（詳細步驟）

#### 步驟1：創建道具拾取物件
1. 在Hierarchy中創建一個空的GameObject
2. 重命名為"ItemPickup"
3. 添加以下組件：
   - **Collider** (建議使用Sphere Collider，設置為Trigger)
   - **Rigidbody** (設置為Kinematic)
   - **AudioSource** (用於播放拾取音效)

#### 步驟2：添加視覺效果
**3D模型或Sprite**
- 添加道具的3D模型或Sprite Renderer
- 設置適當的大小和材質

**粒子效果（可選）**
- 添加Particle System組件
- 設置為環繞或浮動效果

#### 步驟3：添加ItemPickup組件
1. 選擇ItemPickup物件
2. 在Inspector中點擊"Add Component"
3. 搜尋並添加"ItemPickup"組件

#### 步驟4：配置ItemPickup組件
**道具設定**
- **itemType**: 選擇道具類型（MedicinePill/SteelSugar/HealingGourd）
- **quantity**: 設置拾取數量

**拾取設定**
- **pickupRange**: 拾取範圍（建議：2-3）
- **destroyOnPickup**: 拾取後是否銷毀

**視覺效果**
- **rotationSpeed**: 旋轉速度（建議：50）
- **bobSpeed**: 上下浮動速度（建議：2）
- **bobHeight**: 浮動高度（建議：0.5）
- **pickupEffect**: 拾取特效預製體
- **pickupSound**: 拾取音效

#### 步驟5：創建預製體
1. 將ItemPickup從Hierarchy拖拽到Project視窗
2. 刪除Hierarchy中的ItemPickup
3. 將Project中的預製體拖拽到ItemManager組件的itemPickupPrefab欄位

### 4. 設置道具管理器（詳細步驟）

#### 步驟1：創建道具管理器
1. 在Hierarchy中創建一個空的GameObject
2. 重命名為"ItemManager"
3. 在Inspector中點擊"Add Component"
4. 搜尋並添加"ItemManager"組件

#### 步驟2：配置生成設定
**基本設定**
- **itemPickupPrefab**: 拖拽道具拾取預製體
- **autoSpawn**: 是否自動生成道具
- **spawnInterval**: 生成間隔時間（秒，建議：60-120）

**道具機率設定**
- **medicinePillChance**: 藥丸生成機率（0-1，建議：0.4）
- **steelSugarChance**: 剛幹糖生成機率（0-1，建議：0.3）
- **healingGourdChance**: 傷藥葫蘆生成機率（0-1，建議：0.3）

#### 步驟3：設置生成點
**方法1：手動設置**
1. 在場景中創建空的GameObject作為生成點
2. 重命名為"SpawnPoint_1"、"SpawnPoint_2"等
3. 將這些GameObject的Transform拖拽到ItemManager的spawnPoints陣列中

**方法2：程式碼設置**
```csharp
ItemManager itemManager = FindObjectOfType<ItemManager>();
itemManager.AddSpawnPoint(spawnPointTransform);
```

#### 步驟4：測試生成
**手動生成道具**
```csharp
ItemManager itemManager = FindObjectOfType<ItemManager>();
// 在指定位置生成隨機道具
itemManager.SpawnRandomItem(Vector3.zero);
// 在指定位置生成特定道具
itemManager.SpawnItem(ItemSystem.ItemType.MedicinePill, Vector3.zero, 1);
```

**控制生成**
```csharp
// 暫停自動生成
itemManager.SetAutoSpawn(false);
// 恢復自動生成
itemManager.SetAutoSpawn(true);
// 設置生成間隔
itemManager.SetSpawnInterval(90f);
```

#### 步驟5：場景佈局建議
**生成點佈局**
- 在玩家可能經過的路徑上設置生成點
- 避免在敵人密集區域設置
- 建議間距：10-20單位
- 數量建議：5-10個生成點

**視覺提示**
- 可以在生成點位置放置標記物件
- 使用Gizmos在Scene視圖中顯示生成範圍

## 使用方法

### 玩家操作
- **R鍵**：切換道具
- **E鍵**：使用當前選中的道具
- **E鍵**：拾取道具（在道具附近時）

### 程式碼使用範例

#### 添加道具
```csharp
ItemSystem itemSystem = player.GetComponent<ItemSystem>();
itemSystem.AddItem(ItemSystem.ItemType.MedicinePill, 3);
```

#### 獲取道具數量
```csharp
int quantity = itemSystem.GetItemQuantity(ItemSystem.ItemType.HealingGourd);
```

#### 生成道具
```csharp
ItemManager manager = FindObjectOfType<ItemManager>();
manager.SpawnItem(ItemSystem.ItemType.MedicinePill, Vector3.zero, 1);
```

#### 事件監聽
```csharp
itemSystem.OnItemUsed += (item) => {
    Debug.Log($"使用了 {item.name}");
};

itemSystem.OnItemSwitched += (item) => {
    Debug.Log($"切換到 {item.name}");
};
```

## 主要改進

### 1. 程式碼整合
- **原本**：5個檔案，約1500行程式碼
- **簡化後**：4個檔案，約700行程式碼
- **減少**：53%的程式碼量

### 2. 結構簡化
- 將 `ItemSystem`、`ItemUI` 整合為一個檔案
- `ItemSlotUI` 獨立為單獨檔案，提高模組化
- 移除重複的程式碼和複雜的事件系統
- 簡化UI更新邏輯

### 3. 功能保留
- ✅ 道具切換（R鍵）
- ✅ 道具使用（E鍵）
- ✅ 道具拾取
- ✅ 冷卻系統
- ✅ 使用動畫
- ✅ 視覺效果
- ✅ 音效系統
- ✅ 自動生成

### 4. 易於擴展
- 簡化的結構更容易添加新道具類型
- 清晰的程式碼組織
- 減少依賴關係
- 更好的模組化設計

### 5. TextMeshPro支援
- 使用現代化的文字渲染系統
- 更好的文字品質和性能
- 支援富文字格式
- 更好的國際化支援

## 遷移指南

### 從舊系統遷移
1. **移除舊組件**：
   - 移除 `ItemSystem`
   - 移除 `ItemUI`
   - 移除 `ItemSlotUI`
   - 移除 `ItemPickup`
   - 移除 `ItemManager`

2. **添加新組件**：
   - 添加 `ItemSystem` 到玩家
   - 添加 `ItemPickup` 到道具預製體
   - 添加 `ItemManager` 到場景

3. **更新UI設定**：
   - 重新設定UI組件引用
   - 更新道具槽預製體
   - 確保使用TextMeshPro組件

4. **測試功能**：
   - 確認道具切換正常
   - 確認道具使用正常
   - 確認道具拾取正常

## 自定義配置

### 添加新道具類型
1. 在 `ItemSystem.ItemType` 枚舉中添加新類型
2. 在 `CreateDefaultItems()` 方法中添加預設設定
3. 在 `ApplyItemEffect()` 方法中添加效果邏輯

### 修改道具效果
直接在 `ItemSystem` 組件中調整：
- `items` 列表中的道具參數
- `useAnimationTime` 使用動畫時間
- `useEffectPrefab` 使用效果預製體

### 修改UI樣式
在 `ItemSlotUI` 類別中調整：
- 顏色設定
- UI組件引用
- 視覺效果

### TextMeshPro設定
- 可以自定義字體資源
- 調整文字渲染設定
- 使用富文字標籤
- 設定文字動畫效果

## 性能優化

### 已實現的優化
- 減少不必要的Update調用
- 簡化事件系統
- 整合UI更新邏輯
- 減少組件查找
- TextMeshPro的高效渲染

### 進一步優化建議
- 使用物件池管理道具拾取物件
- 批量更新UI元素
- 使用協程控制更新頻率
- 優化TextMeshPro字體資源

## 故障排除

### 常見問題
1. **道具無法使用**
   - 檢查 `ItemSystem` 組件是否正確添加
   - 確認UI組件引用是否正確
   - 檢查道具數量是否大於0

2. **UI不顯示**
   - 確認 `itemContainer` 和 `itemSlotPrefab` 已設定
   - 檢查Canvas是否啟用
   - 確認道具槽預製體包含必要組件

3. **道具拾取失敗**
   - 檢查 `ItemPickup` 組件設定
   - 確認玩家有 `ItemSystem` 組件
   - 檢查拾取範圍設定

4. **找不到ItemSlotUI組件**
   - 確保 `ItemSlotUI.cs` 檔案已正確編譯
   - 檢查Unity Console是否有編譯錯誤
   - 重新導入 `ItemSlotUI.cs` 檔案
   - 如果問題持續，請重新啟動Unity編輯器

5. **TextMeshPro相關問題**
   - 確保已安裝TextMeshPro套件
   - 檢查字體資源是否正確載入
   - 確認TMP_Text組件設定正確
   - 檢查字體材質是否正確

## 技術細節

### 道具效果實現
- **藥丸 (MedicinePill)**: 緩慢恢復生命值，每秒恢復3HP，持續30秒
- **剛幹糖 (SteelSugar)**: 減少架勢增加，效果值為10，持續30秒
- **傷藥葫蘆 (HealingGourd)**: 立即恢復生命值40HP

### 冷卻系統
- 每個道具都有獨立的冷卻時間
- 冷卻期間道具無法使用
- 冷卻效果以視覺遮罩顯示

### 架勢系統整合
- 剛幹糖效果會影響架勢增加量
- 通過 `GetPostureReductionRate()` 方法獲取當前架勢減少倍率
- 在 `HealthPostureController` 中自動應用架勢效果

### TextMeshPro整合
- 使用 `TMP_Text` 組件替代傳統 `Text` 組件
- 支援富文字格式和動態文字更新
- 更好的文字渲染品質和性能

## 總結

這個簡化版本的道具系統：
- **大幅減少程式碼量**（53%減少）
- **保持所有核心功能**
- **提高維護性**
- **降低學習成本**
- **保持隻狼風格體驗**
- **更好的模組化設計**
- **現代化TextMeshPro支援**

適合需要快速實現道具系統的專案，同時為後續擴展留下良好基礎。 