# EnemyPool 敵人預載入系統

## 概述
`EnemyPool` 是一個專門用於**加速場景載入**的敵人預載入系統。當您的遊戲場景因為敵人預製體而載入緩慢時，這個系統可以預先載入敵人預製體，避免運行時的實例化延遲。

## 問題解決
### 原始問題
- 場景載入時需要實例化敵人預製體
- 每個敵人預製體包含複雜的組件（動畫器、碰撞器、腳本等）
- 導致場景載入時間從幾秒增加到20秒

### 解決方案
- **預載入機制**：在場景載入時預先創建所有敵人實例
- **物件重用**：敵人死亡後回收到物件池，而不是銷毀
- **零實例化延遲**：運行時直接啟用預載入的敵人，無需等待

## 主要功能

### 1. 預載入系統
- 在場景載入時預先創建指定數量的敵人實例
- 支援多種敵人預製體同時預載入
- 可設定每個預製體的預載入數量

### 2. 物件池管理
- 敵人死亡後自動回收到物件池
- 重置敵人狀態，準備重用
- 避免頻繁的物件創建和銷毀

### 3. 效能優化
- 減少運行時的記憶體分配
- 避免垃圾回收造成的卡頓
- 提升整體遊戲流暢度

## 設定說明

### Inspector 參數

#### 敵人預製體設定
- **Enemy Prefabs**：需要預載入的敵人預製體陣列
  - `Enemy Prefab`：敵人預製體
  - `Preload Count`：預載入數量（建議3-5個）

#### 物件池設定
- **Pool Parent**：物件池父物件（可選）

#### 預載入設定
- **Preload On Start**：是否在Start時自動預載入
- **Show Debug Info**：是否顯示除錯資訊

## 使用方法

### 1. 基本設置
1. 在場景中創建一個空物件
2. 添加 `EnemyPool` 腳本
3. 在 Inspector 中設置需要預載入的敵人預製體
4. 設定每個預製體的預載入數量

### 2. 敵人腳本設置
確保敵人預製體包含 `EnemyTest` 腳本：
```csharp
// 在EnemyTest中設置
public bool useObjectPool = true; // 啟用物件池
public float deathAnimationDuration = 2f; // 死亡動畫時間
```

### 3. 程式碼使用
```csharp
EnemyPool enemyPool = FindObjectOfType<EnemyPool>();

// 手動預載入
enemyPool.PreloadEnemyPrefabs();

// 取得預載入的敵人
GameObject enemy = enemyPool.GetPreloadedEnemy(enemyPrefab);

// 查看統計資訊
enemyPool.GetPoolStatistics();
```

## 工作流程

### 1. 場景載入階段
```
場景載入開始
├── EnemyPool.Start()
├── PreloadEnemyPrefabs()
│   ├── 創建物件池字典
│   ├── 預載入每個敵人預製體
│   │   ├── Instantiate(prefab) - 創建實例
│   │   ├── SetActive(false) - 停用實例
│   │   └── 加入物件池
│   └── 完成預載入
└── 場景載入完成
```

### 2. 運行時使用
```
需要敵人時
├── GetPreloadedEnemy(prefab)
├── 從物件池取得停用的敵人
├── SetActive(true) - 啟用敵人
├── 設置位置和狀態
└── 敵人開始活動
```

### 3. 敵人死亡回收
```
敵人死亡
├── EnemyTest.Die()
├── 播放死亡動畫
├── 等待動畫完成
├── ReturnEnemyToPool()
│   ├── 重置敵人狀態
│   ├── SetActive(false) - 停用敵人
│   └── 回收到物件池
└── 準備重用
```

## 效能提升效果

### 載入時間對比
- **原始方式**：20秒載入時間
- **使用預載入**：幾秒載入時間
- **提升幅度**：70-80% 載入時間減少

### 記憶體使用
- **預載入階段**：一次性分配所有敵人記憶體
- **運行時**：零記憶體分配，只有物件重用
- **垃圾回收**：大幅減少GC壓力

## 最佳實踐

### 1. 預載入數量設定
```csharp
// 根據遊戲需求設定
小型關卡：3-5個每個預製體
中型關卡：5-10個每個預製體
大型關卡：10-20個每個預製體
```

### 2. 敵人預製體優化
- 減少不必要的組件
- 優化動畫器設定
- 使用LOD系統
- 合併材質和貼圖

### 3. 場景設計
- 避免同時載入過多敵人預製體
- 使用分層載入
- 考慮敵人類型的多樣性

## 測試和除錯

### Inspector 測試
- 右鍵點擊 `EnemyPool` 組件
- 選擇 "手動預載入所有敵人"
- 選擇 "取得物件池統計資訊"

### 程式碼測試
```csharp
// 測試預載入
enemyPool.PreloadEnemyPrefabs();

// 測試取得敵人
GameObject enemy = enemyPool.GetPreloadedEnemy(testPrefab);

// 測試統計
enemyPool.GetPoolStatistics();

// 測試可用數量
int available = enemyPool.GetAvailableCount(testPrefab);
```

## 注意事項

### 1. 記憶體管理
- 預載入會佔用更多初始記憶體
- 但運行時記憶體使用更穩定
- 適合記憶體充足的平台

### 2. 敵人腳本整合
- 確保 `EnemyTest` 正確設置
- 死亡動畫時間要準確設定
- 測試物件池回收功能

### 3. 場景切換
- 場景切換時物件池會被清理
- 新場景需要重新預載入
- 考慮跨場景物件池

## 故障排除

### 預載入失敗
- 檢查敵人預製體是否正確設置
- 確認預製體包含必要組件
- 檢查記憶體是否充足

### 敵人不會回收
- 確認 `useObjectPool = true`
- 檢查死亡動畫時間設定
- 確認 `EnemyPool` 存在於場景中

### 效能問題
- 減少預載入數量
- 優化敵人預製體
- 檢查其他效能瓶頸

這個系統專門解決場景載入緩慢的問題，讓您的遊戲載入更快速，運行更流暢！
