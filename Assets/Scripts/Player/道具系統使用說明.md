# 道具系統使用說明

## 概述
這個道具系統完全模仿隻狼（Sekiro: Shadows Die Twice）的道具系統設計，提供原汁原味的隻狼體驗，包含三種主要道具：
- **藥丸**：緩慢恢復生命值
- **剛幹糖**：減少敵人攻擊增長的架勢槽
- **傷藥葫蘆**：立即恢復生命值

### 🎮 隻狼風格特色
- ✅ **R鍵切換道具** - 與隻狼完全一致的操作方式
- ✅ **E鍵使用道具** - 簡潔直觀的使用方式
- ✅ **架勢系統整合** - 剛幹糖影響架勢槽，完全符合隻狼機制
- ✅ **使用動畫** - 道具使用時播放動畫，增加沉浸感
- ✅ **狀態限制** - 在移動或攻擊時限制道具使用
- ✅ **視覺反饋** - 進度條和動畫效果

## 系統架構

### 核心組件
1. **ItemSystem.cs** - 道具系統主控制器
2. **ItemUI.cs** - 道具UI管理
3. **ItemSlotUI.cs** - 單個道具槽UI
4. **ItemPickup.cs** - 道具拾取系統
5. **ItemManager.cs** - 道具生成管理器

### 道具類型
```csharp
public enum ItemType
{
    MedicinePill,    // 藥丸
    SteelSugar,      // 剛幹糖
    HealingGourd     // 傷藥葫蘆
}
```

## 安裝步驟

### 1. 設置玩家道具系統
1. 在玩家物件上添加 `ItemSystem` 組件
2. 配置道具效果參數：
   - `medicinePillHealPerSecond`: 藥丸每秒恢復量（預設：5）
   - `medicinePillDuration`: 藥丸持續時間（預設：10秒）
   - `steelSugarPostureReduction`: 剛幹糖架勢減少倍率（預設：0.5）
   - `steelSugarDuration`: 剛幹糖持續時間（預設：15秒）
       - `healingGourdHealAmount`: 傷藥葫蘆恢復量（預設：30）
    
    **隻狼風格設定**：
    - `itemUseAnimationTime`: 道具使用動畫時間（預設：1.5秒）
    - `canUseItemWhileMoving`: 是否可以在移動時使用道具（預設：false）
    - `canUseItemWhileAttacking`: 是否可以在攻擊時使用道具（預設：false）

### 2. 設置道具UI
1. 創建UI Canvas
2. 添加 `ItemUI` 組件到Canvas
3. 創建道具槽預製體，包含：
   - 道具圖示 (Image)
   - 數量文字 (Text)
   - 背景圖片 (Image)
   - 冷卻圖片 (Image)
4. 添加 `ItemSlotUI` 組件到預製體
5. 設定道具圖示資源
6. 添加當前選中道具顯示UI：
   - 當前道具圖示 (Image)
   - 當前道具名稱 (Text)
   - 當前道具數量 (Text)
   - 選中高亮效果 (GameObject)

7. 添加隻狼風格UI：
   - 隻狼風格UI容器 (GameObject)
   - 道具使用進度條 (Image)
   - 道具使用動畫效果 (GameObject)
   - 道具使用音效 (AudioClip)

### 3. 設置道具拾取系統
1. 創建道具拾取預製體
2. 添加 `ItemPickup` 組件
3. 配置拾取參數和視覺效果

### 4. 設置道具管理器（可選）
1. 在場景中添加 `ItemManager` 組件
2. 設定道具生成點
3. 配置自動生成參數

## 使用方法

### 玩家操作
- **R鍵**：切換道具
- **E鍵**：使用當前選中的道具
- **E鍵**：拾取道具（在道具附近時）

### 道具效果

#### 藥丸 (MedicinePill)
- **效果**：緩慢恢復生命值
- **持續時間**：10秒
- **恢復速度**：每秒5點生命值
- **冷卻時間**：15秒
- **限制**：不能重複使用

#### 剛幹糖 (SteelSugar)
- **效果**：減少敵人攻擊增長的架勢槽
- **持續時間**：15秒
- **效果倍率**：架勢增加量減少50%
- **冷卻時間**：20秒
- **限制**：不能重複使用

#### 傷藥葫蘆 (HealingGourd)
- **效果**：立即恢復生命值
- **恢復量**：30點生命值
- **冷卻時間**：5秒
- **限制**：無

### 程式碼使用範例

#### 添加道具到玩家背包
```csharp
ItemSystem itemSystem = player.GetComponent<ItemSystem>();
Item newItem = new Item("藥丸", ItemType.MedicinePill, 1, 5f, 10f, "緩慢恢復生命值");
itemSystem.AddItem(newItem);
```

#### 使用當前選中的道具
```csharp
bool success = itemSystem.UseCurrentSelectedItem();
if (success)
{
    Debug.Log("道具使用成功！");
}
```

#### 切換道具
```csharp
itemSystem.SwitchToNextItem();
```

#### 獲取當前選中的道具
```csharp
Item currentItem = itemSystem.GetCurrentSelectedItem();
if (currentItem != null)
{
    Debug.Log($"當前選中：{currentItem.itemName}");
}
```

#### 檢查道具數量
```csharp
int quantity = itemSystem.GetItemQuantity(ItemType.HealingGourd);
Debug.Log($"傷藥葫蘆數量：{quantity}");
```

#### 生成道具
```csharp
ItemManager itemManager = FindObjectOfType<ItemManager>();
GameObject spawnedItem = itemManager.SpawnItem(ItemType.MedicinePill, Vector3.zero, 1);
```

## 事件系統

### 可用事件
```csharp
// 道具使用事件
itemSystem.OnItemUsed += (Item item) => {
    Debug.Log($"使用了 {item.itemName}");
};

// 道具添加事件
itemSystem.OnItemAdded += (Item item) => {
    Debug.Log($"獲得了 {item.itemName} x{item.quantity}");
};

// 道具移除事件
itemSystem.OnItemRemoved += (Item item) => {
    Debug.Log($"{item.itemName} 已用完");
};

// 道具切換事件
itemSystem.OnItemSwitched += (Item item) => {
    Debug.Log($"切換到 {item.itemName}");
};
```

## 自定義配置

### 修改道具效果
在 `ItemSystem` 組件中調整以下參數：
- `medicinePillHealPerSecond`: 調整藥丸恢復速度
- `steelSugarPostureReduction`: 調整剛幹糖效果強度
- `healingGourdHealAmount`: 調整傷藥葫蘆恢復量

### 修改冷卻時間
在 `ItemSlotUI.cs` 的 `GetCooldownDuration()` 方法中調整：
```csharp
switch (itemType)
{
    case ItemType.MedicinePill:
        return 15f; // 藥丸冷卻15秒
    case ItemType.SteelSugar:
        return 20f; // 剛幹糖冷卻20秒
    case ItemType.HealingGourd:
        return 5f;  // 傷藥葫蘆冷卻5秒
}
```

### 添加新道具類型
1. 在 `ItemType` 枚舉中添加新類型
2. 在 `ItemSystem.UseItem()` 方法中添加處理邏輯
3. 在 `ItemSlotUI.GetItemDescription()` 中添加描述
4. 在 `ItemPickup.GetItemName()` 中添加名稱

## 故障排除

### 常見問題
1. **道具無法使用**
   - 檢查玩家是否有 `ItemSystem` 組件
   - 確認道具數量大於0
   - 檢查是否在冷卻中

2. **UI不顯示**
   - 確認 `ItemUI` 組件已正確配置
   - 檢查道具槽預製體是否包含必要組件
   - 確認UI Canvas已啟用

3. **道具效果不生效**
   - 檢查 `HealthPostureController` 是否正確引用
   - 確認道具效果參數設定正確
   - 檢查是否有衝突的腳本

### 調試方法
```csharp
// 在控制台輸出道具系統狀態
ItemSystem itemSystem = FindObjectOfType<ItemSystem>();
if (itemSystem != null)
{
    Debug.Log($"藥丸數量：{itemSystem.GetItemQuantity(ItemType.MedicinePill)}");
    Debug.Log($"剛幹糖數量：{itemSystem.GetItemQuantity(ItemType.SteelSugar)}");
    Debug.Log($"傷藥葫蘆數量：{itemSystem.GetItemQuantity(ItemType.HealingGourd)}");
}
```

## 性能優化建議

1. **物件池化**：對道具拾取物件使用物件池
2. **事件優化**：及時取消訂閱事件避免記憶體洩漏
3. **UI更新**：使用協程控制UI更新頻率
4. **碰撞檢測**：使用Trigger而非Collision進行拾取檢測

## 擴展功能

### 可能的擴展
1. **道具合成系統**
2. **道具品質等級**
3. **道具耐久度**
4. **道具商店系統**
5. **道具成就系統**

這個道具系統提供了完整的基礎功能，您可以根據遊戲需求進行進一步的擴展和修改。 